"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GtfsRealtimeFetcher=void 0,exports.ToRealTime=ToRealTime,exports.IdToStationInfo=IdToStationInfo;const gtfs_realtime_bindings_1=__importDefault(require("gtfs-realtime-bindings"));class GtfsRealtimeFetcher{constructor(){this.url="https://proxy.transport.data.gouv.fr/resource/ilevia-lille-gtfs-rt",this.updateCallback=null,this.errorCallback=null,this.intervalId=null}async fetchData(){try{let t=await fetch(this.url);if(!t.ok)throw new Error(`Erreur: ${t.status} ${t.statusText}`);let e=await t.arrayBuffer(),r=gtfs_realtime_bindings_1.default.transit_realtime.FeedMessage.decode(new Uint8Array(e));this.updateCallback&&this.updateCallback(r.entity)}catch(t){this.errorCallback&&this.errorCallback("Erreur lors de la récupération des données GTFS-RT: "+t)}}update(t){this.updateCallback=t}error(t){this.errorCallback=t}start(t=3e4){this.fetchData(),this.intervalId=setInterval(()=>this.fetchData(),t)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}function ToRealTime(t){return new Date(1e3*t).toLocaleString("fr-FR",{timeZone:"Europe/Paris",timeStyle:"short",dateStyle:"medium"})}async function IdToStationInfo(t){try{let e=await fetch("https://data.lillemetropole.fr/data/ogcapi/collections/ilevia:arret_point/items?f=json&limit=-1");if(!e.ok)throw new Error(`Erreur: ${e.status} ${e.statusText}`);let r=await e.json(),a=(await r.records).find(e=>e.stop_id===t);return a||new Error(`No stop found for ID: ${t}`)}catch(t){throw new Error(`Erreur: ${t}`)}}exports.GtfsRealtimeFetcher=GtfsRealtimeFetcher;